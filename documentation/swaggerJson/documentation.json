{
  "openapi": "3.0.0",
  "info": {
    "title": "Task Management API",
    "description": "Complete API for managing users, tasks, projects, and collaborations",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Local Development Server"
    }
  ],
  "tags": [
    {
      "name": "User",
      "description": "User management and authentication"
    },
    {
      "name": "Team & Department",
      "description": "Team and department management"
    },
    {
      "name": "Task",
      "description": "Task management operations"
    },
    {
      "name": "Project",
      "description": "Project management operations"
    },
    {
      "name": "Comment",
      "description": "Comment management"
    },
    {
      "name": "Attachment",
      "description": "File attachment management"
    },
    {
      "name": "Collaborator",
      "description": "Task and project collaborator management"
    },
    {
      "name": "Report",
      "description": "Generating, retrieving, and managing user/project reports"
    },
    {
      "name": "Health",
      "description": "Health check endpoints"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health check",
        "description": "Check if the task management service is healthy",
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string", "example": "healthy" },
                    "service": { "type": "string", "example": "task_management" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/user/create": {
      "post": {
        "tags": ["User"],
        "summary": "Create a new user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["username", "name", "email", "password"],
                "properties": {
                  "username": { "type": "string", "example": "johndoe" },
                  "name": { "type": "string", "example": "John Doe" },
                  "email": { "type": "string", "example": "john.doe@example.com" },
                  "password": { "type": "string", "example": "strongpassword123" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "User created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/User" } } } },
          "400": { "description": "Missing required fields", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } } },
          "409": { "description": "User already exists", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Error" } } } }
        }
      }
    },
    "/user/login": {
      "post": {
        "tags": ["User"],
        "summary": "User login",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": { "type": "string", "example": "john.doe@example.com" },
                  "password": { "type": "string", "example": "strongpassword123" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": { "type": "string" },
                    "userID": { "type": "integer" },
                    "name": { "type": "string" },
                    "role": { "type": "string" },
                    "username": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": { "description": "Missing credentials" },
          "401": { "description": "Invalid credentials" },
          "500": { "description": "Server error" }
        }
      }
    },
    "/user/verifyJWT": {
      "get": {
        "tags": ["User"],
        "summary": "Verify JWT token",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Token valid", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/User" } } } },
          "401": { "description": "Invalid token" },
          "404": { "description": "User not found" }
        }
      }
    },
    "/user/{user_id}": {
      "get": {
        "tags": ["User"],
        "summary": "Get user by ID",
        "parameters": [{ "name": "user_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "User found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/User" } } } },
          "404": { "description": "User not found" }
        }
      }
    },
    "/user": {
      "get": {
        "tags": ["User"],
        "summary": "Get all users",
        "responses": {
          "200": { "description": "Users list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/User" } } } } }
        }
      }
    },
    "/user/teams": {
      "get": {
        "tags": ["Team & Department"],
        "summary": "Get all teams",
        "responses": {
          "200": { "description": "Teams list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Team" } } } } }
        }
      }
    },
    "/user/team/{team_id}": {
      "get": {
        "tags": ["Team & Department"],
        "summary": "Get users in team",
        "parameters": [{ "name": "team_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Team users", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/User" } } } } }
        }
      }
    },
    "/user/departments": {
      "get": {
        "tags": ["Team & Department"],
        "summary": "Get all departments",
        "responses": {
          "200": { "description": "Departments list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Department" } } } } }
        }
      }
    },
    "/user/department/{dept_id}": {
      "get": {
        "tags": ["Team & Department"],
        "summary": "Get users in department",
        "parameters": [{ "name": "dept_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Department users", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/User" } } } } }
        }
      }
    },
    "/tasks": {
      "get": {
        "tags": ["Task"],
        "summary": "Get all tasks",
        "parameters": [
          { "name": "owner_id", "in": "query", "required": true, "schema": { "type": "integer" } },
          { "name": "status", "in": "query", "required": false, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Tasks list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Task" } } } } },
          "400": { "description": "Owner ID required" }
        }
      },
      "post": {
        "tags": ["Task"],
        "summary": "Create task",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title", "owner_id"],
                "properties": {
                  "title": { "type": "string" },
                  "description": { "type": "string" },
                  "deadline": { "type": "string", "format": "date-time" },
                  "status": { "type": "string" },
                  "owner_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Task created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Task" } } } }
        }
      }
    },
    "/tasks/with-deadlines": {
      "get": {
        "tags": ["Task"],
        "summary": "Get tasks with upcoming deadlines",
        "responses": {
          "200": { "description": "Tasks with deadlines", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Task" } } } } }
        }
      }
    },
    "/tasks/standalone": {
      "get": {
        "tags": ["Task"],
        "summary": "Get standalone tasks",
        "parameters": [{ "name": "user_id", "in": "query", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Standalone tasks", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Task" } } } } }
        }
      }
    },
    "/tasks/{task_id}": {
      "get": {
        "tags": ["Task"],
        "summary": "Get task by ID",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Task details", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TaskDetails" } } } },
          "404": { "description": "Task not found" }
        }
      },
      "put": {
        "tags": ["Task"],
        "summary": "Update task",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": { "type": "integer" },
                  "title": { "type": "string" },
                  "description": { "type": "string" },
                  "status": { "type": "string" },
                  "deadline": { "type": "string", "format": "date-time" },
                  "comment": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Task updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TaskDetails" } } } },
          "404": { "description": "Task not found" },
          "403": { "description": "Forbidden" }
        }
      },
      "delete": {
        "tags": ["Task"],
        "summary": "Delete task",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Task deleted", "content": { "application/json": { "schema": { "type": "object", "properties": { "message": { "type": "string" } } } } } },
          "404": { "description": "Task not found" }
        }
      }
    },
    "/tasks/{task_id}/add-to-project": {
      "post": {
        "tags": ["Task"],
        "summary": "Add task to project",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["user_id", "project_id"],
                "properties": {
                  "user_id": { "type": "integer" },
                  "project_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Added to project" },
          "404": { "description": "Not found" },
          "409": { "description": "Already assigned" }
        }
      }
    },
    "/tasks/{task_id}/remove-from-project": {
      "post": {
        "tags": ["Task"],
        "summary": "Remove task from project",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["user_id"],
                "properties": {
                  "user_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Removed from project" },
          "400": { "description": "Not assigned" },
          "404": { "description": "Task not found" }
        }
      }
    },
    "/tasks/{task_id}/comments": {
      "post": {
        "tags": ["Comment"],
        "summary": "Add comment",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["body", "author_id"],
                "properties": {
                  "body": { "type": "string" },
                  "author_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Comment added", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Comment" } } } },
          "404": { "description": "Task not found" }
        }
      }
    },
    "/tasks/deletecomment/{comment_id}": {
      "delete": {
        "tags": ["Comment"],
        "summary": "Delete comment",
        "parameters": [{ "name": "comment_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Comment deleted" },
          "404": { "description": "Comment not found" }
        }
      }
    },
    "/tasks/{task_id}/collaborators": {
      "get": {
        "tags": ["Collaborator"],
        "summary": "Get task collaborators",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Collaborators list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/User" } } } } }
        }
      }
    },
    "/tasks/{task_id}/attachments": {
      "post": {
        "tags": ["Attachment"],
        "summary": "Upload attachment",
        "parameters": [{ "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": { "type": "string", "format": "binary" },
                  "filename": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Uploaded", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Attachment" } } } },
          "400": { "description": "No file" },
          "404": { "description": "Task not found" }
        }
      }
    },
    "/tasks/{task_id}/attachments/{attachment_id}": {
      "get": {
        "tags": ["Attachment"],
        "summary": "Get attachment",
        "parameters": [
          { "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "attachment_id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Attachment found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Attachment" } } } },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "tags": ["Attachment"],
        "summary": "Delete attachment",
        "parameters": [
          { "name": "task_id", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "attachment_id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Deleted" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/projects": {
      "post": {
        "tags": ["Project"],
        "summary": "Create project",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title", "owner_id"],
                "properties": {
                  "title": { "type": "string" },
                  "description": { "type": "string" },
                  "deadline": { "type": "string", "format": "date-time" },
                  "owner_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Project created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Project" } } } }
        }
      }
    },
    "/projects/{project_id}": {
      "get": {
        "tags": ["Project"],
        "summary": "Get project by ID",
        "parameters": [
          { "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "user_id", "in": "query", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Project found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Project" } } } },
          "403": { "description": "Forbidden" },
          "404": { "description": "Not found" }
        }
      },
      "put": {
        "tags": ["Project"],
        "summary": "Update project",
        "parameters": [{ "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["user_id"],
                "properties": {
                  "user_id": { "type": "integer" },
                  "title": { "type": "string" },
                  "description": { "type": "string" },
                  "deadline": { "type": "string", "format": "date-time" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Updated", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Project" } } } },
          "403": { "description": "Forbidden" },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "tags": ["Project"],
        "summary": "Delete project",
        "parameters": [{ "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["user_id"],
                "properties": {
                  "user_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Deleted" },
          "403": { "description": "Forbidden" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/projects/{project_id}/dashboard": {
      "get": {
        "tags": ["Project"],
        "summary": "Get project dashboard",
        "parameters": [
          { "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "user_id", "in": "query", "required": true, "schema": { "type": "integer" } },
          { "name": "status", "in": "query", "schema": { "type": "string" }, "description": "Comma-separated statuses" },
          { "name": "sort_by", "in": "query", "schema": { "type": "string", "default": "deadline" } },
          { "name": "collaborator", "in": "query", "schema": { "type": "string" } },
          { "name": "owner", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Dashboard data" },
          "403": { "description": "Forbidden" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/projects/user/{user_id}": {
      "get": {
        "tags": ["Project"],
        "summary": "Get user's projects",
        "parameters": [
          { "name": "user_id", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "role", "in": "query", "schema": { "type": "string", "enum": ["owner", "collaborator"] } }
        ],
        "responses": {
          "200": { "description": "Projects list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Project" } } } } }
        }
      }
    },
    "/projects/{project_id}/collaborators": {
      "post": {
        "tags": ["Collaborator"],
        "summary": "Add project collaborator",
        "parameters": [{ "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["user_id", "collaborator_user_id"],
                "properties": {
                  "user_id": { "type": "integer" },
                  "collaborator_user_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Added" },
          "403": { "description": "Forbidden" },
          "404": { "description": "Not found" },
          "409": { "description": "Already exists" }
        }
      }
    },
    "/projects/{project_id}/collaborators/{collaborator_user_id}": {
      "delete": {
        "tags": ["Collaborator"],
        "summary": "Remove project collaborator",
        "parameters": [
          { "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } },
          { "name": "collaborator_user_id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["user_id"],
                "properties": {
                  "user_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Removed" },
          "403": { "description": "Forbidden" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/projects/{project_id}/tasks": {
      "get": {
        "tags": ["Project"],
        "summary": "Get project tasks",
        "parameters": [{ "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "responses": {
          "200": { "description": "Tasks list", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/Task" } } } } },
          "404": { "description": "Project not found" }
        }
      },
      "post": {
        "tags": ["Project"],
        "summary": "Create task in project",
        "parameters": [{ "name": "project_id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title", "user_id"],
                "properties": {
                  "title": { "type": "string" },
                  "description": { "type": "string" },
                  "deadline": { "type": "string", "format": "date-time" },
                  "status": { "type": "string" },
                  "user_id": { "type": "integer" },
                  "owner_id": { "type": "integer" }
                }
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Task created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Task" } } } },
          "403": { "description": "Forbidden" },
          "404": { "description": "Project not found" }
        }
      }
    },


    "/reports/project/{project_id}": {
      "post": {
        "tags": ["Report"],
        "summary": "Generate Project PDF Report",
        "description": "Generates a PDF report for a specific project based on a date range.",
        "parameters": [
          {
            "name": "project_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "user_id",
            "in": "query",
            "required": true,
            "description": "The ID of the user requesting the report.",
            "schema": { "type": "integer" }
          }
        ],
        "requestBody": {
          "description": "Date range and timezone for the report. All fields are optional.",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "start_date": {
                    "type": "string",
                    "format": "date",
                    "example": "2025-10-01"
                  },
                  "end_date": {
                    "type": "string",
                    "format": "date",
                    "example": "2025-10-31"
                  },
                  "end_datetime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "An exact end datetime in ISO format (e.g., for 'today'). Overrides end_date if present.",
                    "example": "2025-10-31T14:30:00Z"
                  },
                  "timezone": {
                    "type": "string",
                    "description": "The user's local timezone (e.g., 'America/New_York'). Defaults to UTC.",
                    "example": "Asia/Singapore"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "The generated PDF report file.",
            "content": {
              "application/pdf": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/Error" },
          "500": { "$ref": "#/components/schemas/Error" }
        }
      }
    },
    "/reports/individual/{user_id}": {
      "post": {
        "tags": ["Report"],
        "summary": "Generate Individual PDF Report",
        "description": "Generates a PDF report for an individual user's task performance.",
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "required": true,
            "description": "The ID of the user whose report is being generated.",
            "schema": { "type": "integer" }
          },
          {
            "name": "requesting_user_id",
            "in": "query",
            "required": true,
            "description": "The ID of the user requesting the report (for authorization).",
            "schema": { "type": "integer" }
          }
        ],
        "requestBody": {
          "description": "Date range and timezone for the report. All fields are optional.",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "start_date": {
                    "type": "string",
                    "format": "date",
                    "example": "2025-10-01"
                  },
                  "end_date": {
                    "type": "string",
                    "format": "date",
                    "example": "2025-10-31"
                  },
                  "end_datetime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "An exact end datetime in ISO format (e.g., for 'today'). Overrides end_date if present.",
                    "example": "2025-10-31T14:30:00Z"
                  },
                  "timezone": {
                    "type": "string",
                    "description": "The user's local timezone (e.g., 'America/New_York'). Defaults to UTC.",
                    "example": "Asia/Singapore"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "The generated PDF report file.",
            "content": {
              "application/pdf": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/Error" },
          "500": { "$ref": "#/components/schemas/Error" }
        }
      }
    },
    "/reports/history/{user_id}": {
      "get": {
        "tags": ["Report"],
        "summary": "Retrieve Report History",
        "description": "Retrieves metadata for all reports generated by or for a specific user.",
        "parameters": [
          {
            "name": "user_id",
            "in": "path",
            "required": true,
            "description": "The ID of the user to get report history for.",
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "A list of report metadata objects.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ReportMetadata" }
                }
              }
            }
          },
          "500": { "$ref": "#/components/schemas/Error" }
        }
      }
    },
    "/reports/retrieve/{report_id}": {
      "get": {
        "tags": ["Report"],
        "summary": "Retrieve a Specific Report",
        "description": "Gets a presigned URL to download a specific report file by its ID.",
        "parameters": [
          {
            "name": "report_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "user_id",
            "in": "query",
            "required": true,
            "description": "The ID of the user requesting the report (for authorization).",
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "A JSON object containing the presigned URL for the report.",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ReportPresignedUrl" }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/Error" },
          "404": { "$ref": "#/components/schemas/Error" },
          "500": { "$ref": "#/components/schemas/Error" }
        }
      }
    },
    "/reports/delete/{report_id}": {
      "delete": {
        "tags": ["Report"],
        "summary": "Delete a Specific Report",
        "description": "Deletes a report record and its associated file from storage.",
        "parameters": [
          {
            "name": "report_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "user_id",
            "in": "query",
            "required": true,
            "description": "The ID of the user requesting the deletion (for authorization).",
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Report deleted successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string", "example": "Report deleted successfully." }
                  }
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/Error" },
          "404": { "$ref": "#/components/schemas/Error" },
          "500": { "$ref": "#/components/schemas/Error" }
        }
      }
    }
  },

  
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "username": { "type": "string", "example": "johndoe" },
          "name": { "type": "string", "example": "John Doe" },
          "email": { "type": "string", "example": "john.doe@example.com" },
          "role": { "type": "string", "example": "staff" }
        }
      },
      "Team": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "name": { "type": "string", "example": "Engineering Team" }
        }
      },
      "Department": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "name": { "type": "string", "example": "Engineering" }
        }
      },
      "Task": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 101 },
          "title": { "type": "string", "example": "Complete report" },
          "description": { "type": "string", "example": "Finish Q4 report" },
          "deadline": { "type": "string", "format": "date-time" },
          "status": { "type": "string", "example": "Ongoing" },
          "owner_id": { "type": "integer", "example": 1 },
          "project_id": { "type": "integer", "nullable": true, "example": 5 }
        }
      },
      "TaskDetails": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "deadline": { "type": "string", "format": "date-time" },
          "status": { "type": "string" },
          "owner_id": { "type": "integer" },
          "project_id": { "type": "integer", "nullable": true },
          "comments": { "type": "array", "items": { "$ref": "#/components/schemas/Comment" } },
          "attachments": { "type": "array", "items": { "$ref": "#/components/schemas/Attachment" } }
        }
      },
      "Comment": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "body": { "type": "string" },
          "author_id": { "type": "integer" },
          "task_id": { "type": "integer" },
          "created_at": { "type": "string", "format": "date-time" }
        }
      },
      "Attachment": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "filename": { "type": "string" },
          "url": { "type": "string" },
          "task_id": { "type": "integer" }
        }
      },
      "Project": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "deadline": { "type": "string", "format": "date-time" },
          "owner_id": { "type": "integer" }
        }
      },

      "ReportMetadata": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "report_type": { "type": "string", "example": "Individual" },
          "generated_at": { "type": "string", "format": "date-time" },
          "generated_by_user_id": { "type": "integer" },
          "target_user_id": { "type": "integer", "nullable": true },
          "project_id": { "type": "integer", "nullable": true },
          "file_key": { "type": "string" },
          "date_range_str": { "type": "string", "example": "01 Nov 2025 - 06 Nov 2025" },
          "generated_by_user_name": { "type": "string", "example": "Admin User" },
          "target_user_name": { "type": "string", "example": "Jane Doe", "nullable": true },
          "project_name": { "type": "string", "example": "Project Alpha", "nullable": true }
        }
      },
      "ReportPresignedUrl": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "format": "uri",
            "example": "https://your-s3-bucket.s3.amazonaws.com/reports/report.pdf?..."
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": { "type": "string" }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}